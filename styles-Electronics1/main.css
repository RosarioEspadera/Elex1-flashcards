:root{
  --bg:#0e1320;
  --panel:#12182a;
  --ink:#e8ecf8;
  --muted:#9aa3b2;
  --accent:#7c9cff;
  --accent-2:#22c55e;
  --border:#28324a;
  --card:#0b1020;
  --radius:14px;
  --shadow:0 10px 28px rgba(0,0,0,.35);
}

@media (prefers-color-scheme: light){
  :root{
    --bg:#f6f8fe; --panel:#ffffff; --ink:#0f172a; --muted:#546174; --card:#ffffff; --border:#e6e8ef;
  }
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
  background: radial-gradient(1200px 680px at 50% -10%, var(--panel), var(--bg));
  color:var(--ink);
  -webkit-tap-highlight-color: transparent;
}

.hidden{display:none !important}
.muted{color:var(--muted)}
.badge{padding:.15rem .5rem; border:1px solid var(--border); border-radius:999px; font-size:.8rem; color:var(--muted)}
.emoji{font-size:1.25rem}

.app{min-height:100%; display:grid; grid-template-rows: auto 1fr;}

/* Top bar */
.topbar{
  position:sticky; top:0; z-index:5;
  display:flex; align-items:center; gap:.5rem; padding:.7rem .9rem;
  background:linear-gradient(180deg,var(--panel),transparent);
  border-bottom:1px solid var(--border);
  backdrop-filter: blur(6px);
}
.title{font-size:1.05rem; margin:0; font-weight:600; flex:1; text-align:center}
.icon-btn{
  width:40px; height:40px; display:grid; place-items:center; border:1px solid var(--border);
  border-radius:12px; background:transparent; color:inherit;
}

/* Side sheet */
.sheet{
  position:fixed; inset:0 0 0 auto; width:min(92vw,360px); transform:translateX(100%);
  background:var(--panel); border-left:1px solid var(--border); box-shadow:var(--shadow); z-index:20;
  transition: transform .25s ease;
  display:flex; flex-direction:column;
}
.sheet.open{ transform:translateX(0) }
.sheet-head{display:flex; align-items:center; justify-content:space-between; padding:1rem; border-bottom:1px solid var(--border)}
.sheet-nav{padding:.5rem 1rem; display:flex; flex-direction:column; gap:.3rem}
.sheet-item{
  text-align:left; border:1px solid var(--border); border-radius:12px; padding:.7rem .8rem; background:transparent; color:inherit;
}
.sheet-item.file{display:flex; align-items:center; justify-content:space-between; cursor:pointer}
.sheet-sep{height:1px; background:var(--border); margin:.6rem 0}
.sheet-item.danger{border-color:#ef4444; color:#ef9090}

/* Home */
.view{padding:1rem}
.section-head{display:flex; gap:.6rem; align-items:center; justify-content:space-between; margin:.2rem .1rem 1rem}
.topics{
  display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap:.7rem;
}
.topic-card{
  display:flex; flex-direction:column; gap:.4rem; padding:.9rem;
  border:1px solid var(--border); border-radius:14px; background:linear-gradient(180deg, var(--panel), rgba(255,255,255,.02));
  box-shadow:var(--shadow);
}
.topic-title{font-weight:600}
.topic-meta{font-size:.85rem; color:var(--muted); display:flex; gap:.4rem; flex-wrap:wrap}

/* All cards (grouped by topic) */
.all-by-topic{margin-top:1rem}
.topic-block{border:1px solid var(--border); border-radius:14px; overflow:hidden; margin:.8rem 0; background:var(--panel)}
.topic-block h3{margin:0; padding:.7rem .9rem; border-bottom:1px solid var(--border)}
.card-list{display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:.5rem; padding:.7rem}
.card-mini{
  border:1px solid var(--border); border-radius:10px; padding:.6rem; background:var(--card); min-height:84px;
}
.card-mini .q{font-weight:600}

/* Study */
.study-head{
  display:flex; align-items:center; gap:.6rem; padding:.4rem .2rem 0;
}
.study-title{display:flex; align-items:center; gap:.5rem}
.counter{margin:.5rem 0 .7rem; color:var(--muted); text-align:center}

.card{
  position:relative; width:min(820px, 94vw); height:56vh; margin:0 auto; border:1px solid var(--border);
  border-radius:16px; background:var(--card); perspective:1200px; box-shadow:var(--shadow); overflow:hidden;
}
.card-face{position:absolute; inset:0; padding:1rem; backface-visibility:hidden; overflow:auto}
.card .front{transform:rotateY(0)}
.card .back{transform:rotateY(-180deg)}
.card.flipped .front{transform:rotateY(180deg)}
.card.flipped .back{transform:rotateY(0)}
.card-face{transition: transform .45s ease}

.toolbar{
  position:fixed; bottom:env(safe-area-inset-bottom, 0); left:0; right:0;
  display:grid; grid-template-columns: repeat(5, 1fr); gap:.5rem; padding:.6rem .8rem;
  background:linear-gradient(180deg, transparent, var(--panel)); border-top:1px solid var(--border);
}
.tool{
  height:46px; border:1px solid var(--border); border-radius:12px; background:transparent; color:inherit;
}

/* Dialog */
dialog{border:none; border-radius:16px; padding:0; background:transparent}
.dialog{
  width:min(92vw, 420px); border:1px solid var(--border); border-radius:16px;
  background:var(--panel); color:var(--ink); padding:1rem; box-shadow:var(--shadow)
}
.dialog h3{margin-top:0}
.dialog .row{display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:.4rem 0}
.dialog menu{display:flex; justify-content:flex-end; gap:.5rem; padding-top:.6rem}

/* Accessibility helpers */
.card:focus{outline:2px solid var(--accent)}
.tool:focus,.icon-btn:focus,.sheet-item:focus{outline:2px solid var(--accent); outline-offset:2px}

/* Larger text toggle */
body.large { font-size: 17px; }

/* Reduced motion */
body.reduced .card-face{transition:none}
